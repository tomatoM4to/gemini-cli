# IdeClient

> Gemini CLI와 IDS(VScode) 간의 브릿지 역할을 하는 클래스 로서 CLI가 터미널에서 실행되면서 IDE와 실시간으로 소통할 수 있게 해주는 통신 관리자

### 1. VSCode 를 자동으로 감지, IDE 모드가 활성화 된 경우에만 연결 시도

```typescript
export enum DetectedIde {
  VSCode = 'vscode',
}

export function detectIde(): DetectedIde | undefined {
  if (process.env.TERM_PROGRAM === 'vscode') {
    return DetectedIde.VSCode;
  }
  return undefined;
}

export class IdeClient {
  private readonly currentIde: DetectedIde | undefined;
  private readonly currentIdeDisplayName: string | undefined;

  constructor(ideMode: boolean) {
    this.currentIde = detectIde();           // 현재 실행 중인 IDE 감지
    if (this.currentIde) {
      this.currentIdeDisplayName = getIdeDisplayName(this.currentIde);
    }
    if (!ideMode) {
      return;
    }
    this.init().catch((err) => {
      logger.debug('Failed to initialize IdeClient:', err);
    });
  }
}
```

### 2. 싱글톤 패턴으로 인스턴스 관리하여, 전체 App 에서 하나의 IDE 연결만 유지

```typescript
static getInstance(ideMode: boolean): IdeClient {
  if (!IdeClient.instance) {
    IdeClient.instance = new IdeClient(ideMode);
  }
  return IdeClient.instance;
}
```

### 3. 연결 상태 관리 : IDE 와의 연결 상태를 관리하고 실패시, 사용자에게 오류 메시지 제공

```typescript
export type IDEConnectionState = {
  status: IDEConnectionStatus;
  details?: string; // User-facing
};

export enum IDEConnectionStatus {
  Connected = 'connected',
  Disconnected = 'disconnected',
  Connecting = 'connecting',
}

export class IdeClient {
  private state: IDEConnectionState = {
    status: IDEConnectionStatus.Disconnected,
  };
}
```

### 4. ...